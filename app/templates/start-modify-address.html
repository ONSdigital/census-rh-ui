{% extends 'base-' + display_region + '.html' %}

{% set messages_dict=dict(get_flashed_messages()|groupby('level')) %}
{% set field_messages_dict=dict(messages_dict['ERROR']|groupby('field')) %}

{% from 'components/question/_macro.njk' import onsQuestion %}
{% from 'components/address/_macro.njk' import onsAddressInput %}
{% from 'components/button/_macro.njk' import onsButton %}

{% set form =  {
    'method': 'POST',
    'attributes': {
        'action': url('StartModifyAddress:post', display_region=display_region)
    }
} %}

{% block main %}

    {% if messages_dict %}
        {% include 'partials/messages.html' with context %}
    {% endif %}

    {% call onsQuestion({
        'title': _('Change your address')
    }) %}

        {% if 'address' in field_messages_dict %}
            {{ onsAddressInput({
                'id': 'address',
                'line1': {
                    'label': _('Building and street'),
                    'value': addressLine1,
                    'error': {
                        'text': _('Enter address to continue')
                    }
                },
                'line2': {
                    'label': _('Line 2'),
                    'value': addressLine2
                },
                'line3': {
                    'label': _('Line 3'),
                    'value': addressLine3
                },
                'town': {
                    'label': _('Town or City'),
                    'value': townName
                },
                'postcode': {
                    'label': _('Postcode'),
                    'value': postcode
                }
            }) }}
        {% else %}
            {{ onsAddressInput({
                'id': 'address',
                'line1': {
                    'label': _('Building and street'),
                    'value': addressLine1,
                },
                'line2': {
                    'label': _('Line 2'),
                    'value': addressLine2
                },
                'line3': {
                    'label': _('Line 3'),
                    'value': addressLine3
                },
                'town': {
                    'label': _('Town or City'),
                    'value': townName
                },
                'postcode': {
                    'label': _('Postcode'),
                    'value': postcode
                }
            }) }}
        {% endif %}
    {% endcall %}

    {{
        onsButton({
            'text': _('Save and continue'),
            'classes': 'u-mt-l',
            'name': 'action[save_continue]'
        })
    }}


{% endblock %}
