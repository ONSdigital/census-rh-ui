{% extends 'base-' + display_region + '.html' %}

{% set request_access_code_link = url('CommonEnterAddress:get', display_region=display_region, user_journey='requests', sub_user_journey='access-code') %}
{% set request_individual_code_link = url('RequestCode:get', request_type='individual-code', display_region=display_region) %}
{% set webchat_link = url('WebChat:get', display_region=display_region) %}

{% from 'components/uac/_macro.njk' import onsUACInput %}
{% from 'components/button/_macro.njk' import onsButton %}
{% from 'components/panel/_macro.njk' import onsPanel %}
{% from 'components/lists/_macro.njk' import onsList %}
{% from "components/input/_macro.njk" import onsInput %}

{% set messages_dict=dict(get_flashed_messages()|groupby('level')) %}
{% set field_messages_dict=dict(messages_dict['ERROR']|groupby('field')) %}

{% set form =  {
    'method': 'POST',
    'attributes': {
        'action': url('Start:post', display_region=display_region)
    }
} %}

{% set uac_input = onsUACInput({
        'id': 'uac',
        'name': 'uac',
        'label': {
            'text': _('Enter the 16 character code printed on the letter'),
            'description': _('Keep this code safe and only share it with others in your household')
        },
        'securityMessage': _('Your personal information is protected by law and will be kept confidential.')
    })
%}

{% block main %}

    <h1 class="u-mt-l">{{_('Start Census')}}</h1>

    {% if messages_dict %}
        {% include 'partials/messages.html' with context %}
    {% endif %}

    {% if 'uac' in field_messages_dict %}
        {% call
            onsPanel({
                'type': 'error'
            })
        %}
        {{
            onsList({
                'id': 'link-uac',
                'classes': 'list--bare list--errors u-mb-s',
                'itemsList': [
                    {
                        'text': _('Enter a valid code')
                    }
                ]
            })
        }}
        {{ uac_input }}
        {% endcall %}
    {% else %}
        {{ uac_input }}
    {% endif %}

    {% if adlocation %}
        {{
            onsInput({
                "type": "hidden",
                "classes": "u-d-no",
                "id": "adlocation",
                "name": "adlocation",
                "value": adlocation,
                "label": {
                    "text": "Enter some text",
                    "classes": "u-d-no"
                }
            })
        }}
    {% endif %}

    {{ onsButton({
        'text': _('Access Census'),
        'classes': 'u-mb-xl',
        'name': 'action[save_continue]'
    }) }}

    <h2>{{_("If you donâ€™t have an access code")}}</h2>
    {% autoescape false %}
        <p>{{ _('You can %(open)srequest a new code%(close)s to start a new census if you have lost or not received an access code. This can be sent to you by text or post.', open='<a href="%s">' % request_access_code_link, close='</a>')|safe }}</p>
    {% endautoescape %}

    <h2>{{_("Need to answer separately from your household?")}}</h2>
    {% autoescape false %}
        <p>{{ _('If you need to answer separately from the people you live with, you can %(open)srequest an individual access code%(close)s to start a separate census.', open='<a href="%s">' % request_individual_code_link, close='</a>')|safe }}</p>
    {% endautoescape %}

    <h2>{{_('Need help?')}}</h2>

    {{ onsButton({
        'text': _('Web chat'),
        "type": 'button',
        "classes": 'u-mb-m, u-mt-s',
        "url": webchat_link,
        "newWindow": true,
        'attributes':
            {'onclick': "window.open(this.href,'targetWindow','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=360,height=680'); return false;"}
        })
    }}

{% endblock %}
